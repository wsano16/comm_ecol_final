---
title: "BIOl1425_final"
author: "wsano"
date: "April 8, 2016"
output: html_document
---
Munday (2004) claims that when sampling the 70 individuals of Gobiodon histrio and G. erythrospilus, the expectation for coral species occupancy distribution for each goby species will be virtually identical. Invoking the Lottery Hypothesis, Munday posits that the lack of competitive dominance of one goby species over the other prevents the exclusion of one species or the other from spatial niches. The distribution of goby species in spatial niches is governed by random factors, and therefore they should have an equal probability of occupying any niche. I hypothesize that differences in the abundance of both goby species and coral species (niches) will alter this expectation. The rarer species of goby will rarely occupy the rarest species of coral. Rare gobies have fewer “tickets” for the lottery, and will rarely win the rarest “prize”/spots. This will give the appearance of competitive dominance by the abundant goby, especially when sampling the distribution of niches occupied by X (#) of goby species (A/B) rather than the ratio of goby species A: goby species B at a variety of coral species niches. I would like to run an R simulation to test my hypothesis, randomly drawing gobies from a pool where the ratio of species A to species B is my independent variable. The drawn goby would then be placed via multinomial distribution into one of a variety of niches, the probability of each being specified by the multinomial. By manipulating the abundances of gobies and niches, I could examine the expectation for niche occupancy under the lottery hypothesis under various conditions.

# R Markdown

## step 1: getpool() function

We start by simulating the goby pool from which we will draw to simulate settlement into various spatial niches (coral species). By plugging in the values for an overall sample size (variable "sample_size) and the subset of that sample size that is goby species A ("gobyA"), the getpool() function returns a vector of length "sample_size" with the appropriate number of species A and B.

```{r}
set.seed(1234)

getpool<-function(gobyA,gobyB){
  #gobyA = # of samples size that are species A
  sample_size=gobyA+gobyB
  gobypool<-c(1:sample_size)
  gobypool[1:gobyA]<-"A"
  gobypool[(gobyA+1):sample_size]<-"B"
  return(gobypool)
}
getpool(100,100)
```
## step 2: setting the multinomial probability vector

The next facet of this simulation is creating the environment of spatial niches where the goby species can settle. I will simulate the settlement of goby species in spatial niches of varying abundance using the rmultinom() function. An essential input to this function is a vector that passess the probabilities of each discrete outcome to the multinomial function. The probabilities in this vector can be interpreted here as the relative abundance of coral species/spatial niche types in the system. 
```{r}
coralprobs=function(niches){
  #niches = desired number of niches
  numbervector=c(1:1000)
  #numbervector = vector 1:1000 from which to generate random numbers
  x=sample(numbervector,niches)
  probs=x/sum(x)
  probs=round(probs,2)
  probs=sort(probs,decreasing = T)
  return(probs)
}
coralprobs(6)
```
##step 3: generating data using the multinomial distribution 

Here we pass the data generated by the coralprobs() and getpool() functions to the coraldist() function, which returns a matrix showing the occurrence of each goby species at each coral species.

Coral relative abundance can also be passed to the function directly, which may be advantageous for observing skewed abundances. coralprobs() effectively generates a random set of relative coral abundances, but it is not built to return a weighted set.

```{r}
coraldist=function(corals,pool){
  whereA=c(1:length(corals))
  whereB=c(1:length(corals))
  for(x in 1:length(pool)){
    onefish=sample(x=pool,size = 1,replace = F)
    #sample a fish from the pool, without replacement
    onespot=which(rmultinom(1,1,corals)[,1] == 1)
    #determine the row in which your fish was "found"
  if (onefish=="A"){
    whereA[onespot]=whereA[onespot]+1
    }
  #add 1 to the position in whereA that corresponds to the # coral
  if (onefish=="B"){
    whereB[onespot]=whereB[onespot]+1
    }
    #add 1 to the position in whereB that corresponds to the # coral as represented by the output from coralprobs
  }
  propA=whereA/sum(whereA)
  propB=whereB/sum(whereB)
  niche_matrix=matrix(data = corals,nrow = 1,ncol=length(corals))
  distrib_matrix=rbind(niche_matrix,whereA,propA,whereB,propB)
  colnames(distrib_matrix)=paste("coral", 1:length(corals), sep = "")
  rownames(distrib_matrix)=c("coral rel. abund","goby A absol.","goby A prop", "goby B","goby B prop")
  print(distrib_matrix)
  barplot(height = distrib_matrix[c(3,1,5),],beside = TRUE,names.arg = colnames(distrib_matrix),col = c("lightcoral","white","cadetblue"),xlab = "coral species",ylab = "percent total sample by species",main = "relative distribution of gobies",legend.text = c("A","expected","B"),width = c(1,.2,1))
}

coraldist(corals=coralprobs(10),pool = getpool(100,10000))
coraldist(c(0.9,0.07,0.03),pool = getpool(100,10000))

```
##step 4: investigating the role of our variables, relative abundance (coral species, goby species) and # of niches

note: make sets of plots to be displayed together?
      use a chisq?
use par() function
#further questions: 

  1) This test of concept is designed in response to the Munday 2004 paper, meaning that it is only describing a two-species system. Manipulation of the relative goby abundance variable alone does not seem to cause a deviation from expected coral species occupancy, and my intuition says that adding a third or fourth species to this system would not disturb this property of the simulation. It may, however, cause further skewing of the distribution when manipulating the relative abundance of gobies and corals at the same time.  

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
